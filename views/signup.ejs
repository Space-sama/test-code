<%- include('partials/header_signup'); -%>

<div class="login-form">
    <center><img src="/logo.jpg" alt="logo-emg-rabat-biblioth√®que"></center>
    <form  method="post" data-parsley-validate>

        
        <!-- Name creadential -->
        <div class="inputs">
            <input type="email" name="email" id="email" placeholder="&nbsp;üìß&nbsp;&nbsp;Votre email ?"
            data-parsley-error-message="ce champ est obligatoire.." required/>
            
        </div>
        
        
        <!-- Password creadential -->
        <div class="inputs">
            <input type="password" name="password" id="password" placeholder="&nbsp;üóùÔ∏è&nbsp;&nbsp;Votre mot de passe ?" 
            data-parsley-error-message="ce champ est obligatoire.." required/>
        </div>

        <!-- CSRF Token -->
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">

        <div class="inputs">
            <input type="password" name="conf-password" id="conf-password"
            placeholder="&nbsp;üóùÔ∏è&nbsp;&nbsp;Confirmer votre mot de passe"
            data-parsley-error-message="Les mots de passe n'est pas identiques !"
            data-parsley-equalto="#password" required />
            <div class="password error"></div>
            <div class="email error"></div>
        </div>
        
        
        <div class="acceder">
            <input type="submit"  value="Cr√©er mon compte">
        </div>
        <div class="acceder">
            <a href="/login" class="btn">D√©j√† enregistr√©</a>
        </div>
        
    </form>
    
</div>
<script type="text/javascript" src="/main.js"></script>
<script>
    const form = document.querySelector('form');
    const emailError = document.querySelector('.email.error');
    const passwordError = document.querySelector('.password.error');
  
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
        // reset errors
        emailError.textContent = '';
        passwordError.textContent = '';

      // get values
      const email = form.email.value;
      const password = form.password.value;
  
      try {
      const res = await fetch('/signup', { 
        method: 'POST', 
        body: JSON.stringify({ email, password, status}), 
        headers: {'Content-Type': 'application/json'}
      });
      const data = await res.json();
      console.log(data);
      if (data.errors) {
        emailError.textContent = data.errors.email;
        passwordError.textContent = data.errors.password;
      }
      if (data.user) {
        location.assign('/login');
      }
    }
    catch (err) {
      console.log(err);
    }
    });
  </script>
