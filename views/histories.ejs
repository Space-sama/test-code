<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap4.min.js"></script>

    <!-- - Begin datatables --->
    <link href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css" rel="stylesheet" />
    <!-- - Ends of datatables --->
    <title>Historiques | Cotrans Automobiles</title>
    <style>
        .myContainer {
            margin-top: 80px;
            margin-bottom: 60px;
            padding: 40px;
            background-color: rgb(250, 249, 249);
            border-radius: 1%;
        }
        .btn-view, .btn-delete{
            background-color: transparent;
            border-color: transparent;
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
        background-color: transparent; /* Set the background color to transparent */
        color: inherit; /* Inherit the text color */
        border: none; /* Remove any border */
        }
        ::-webkit-scrollbar {
            width: 10px;
        }
        
        /* Track */
        ::-webkit-scrollbar-track {
            box-shadow: inset 0 0 12px #3783ac; 
            border-radius: 5px;
        }
        
        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: rgb(6, 78, 154); 
            border-radius: 7px;
        }
        
        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: #255c7a; 
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="/">Cotrans Automobiles</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="/">Accueil <span class="sr-only">(current)</span></a>
            </li>
          </ul>
          <% if (user) { %>
          <form class="form-inline my-2 my-lg-0">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="#">Bonjour, <%= user.email %></a>
                </li>
            </ul>
            <a class="btn btn-outline-danger my-2 my-sm-0" href="/logout" type="btn">Se d√©connecter</a>
          </form>
          <% } else{ %>
            <form class="form-inline my-2 my-lg-0">
                <a class="btn btn-outline-danger my-2 my-sm-0" href="/signup" type="btn">Cr√©er un compte</a>
                <a class="btn btn-outline-danger my-2 my-sm-0" href="/login" type="btn">Se connecter</a>
            </form>
        <%}%>
          
        </div>
       
    </nav>
        <div class="container">
            <div class="alert alert-primary text-center" role="alert" style=" margin-top: 3rem;">
                <h5 class="text-center border-gradient-purple">Historiques des Fichiers</h5>
            </div><br />
            
        </div>
        <!-- const emailRegex = /\b[A-Za-z0-9._%+-]+@gbh\.fr\b/; -->
        <center>
            <button type="button" class="btn btn-outline-warning accessPdfButton3">Retourner vers la page d'Accueil</button> 
        </center><br />
        <center>
            <button type="button" class="btn btn-outline-secondary accessPdfButton4">Vers la page des Signataires</button> 
        </center>

<div class="container myContainerr" style="margin-top: 5rem;">
    <table id="example" class="table table-striped table-bordered table-blue" style="width:100%">
        <thead>
            <tr>
                <th  data-priority="2">Num√©ro OR</th>
                <th data-priority="3">Email Client</th>
                <th data-priority="4">Employ√© En Charge</th>
                <th data-priority="5">Date Cr√©ation</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            
            <% histories.forEach(h => { %>
                <%
                // Convert UTC to GST (UTC + 4 hours)
                    let utcDate = new Date(h.created_At);
                    let gstDate = new Date(utcDate.getTime() + 4 * 60 * 60 * 1000);
                    let gstDate2 = new Date(gstDate.getTime() + 3 * 60 * 60 * 1000);

                    // Extract components
                    let d = gstDate2.getDate();
                    let m = gstDate2.getMonth() + 1;
                    let y = gstDate2.getFullYear();
                    let hours = String(gstDate2.getHours()).padStart(2, '0');
                    let minutes = String(gstDate2.getMinutes()).padStart(2, '0');
                %>
            <tr>
                <td><%= h.or_number %></td>
                <td><%= h.email_client %></td>
                <td><%= h.employe_in_charge %></td>
                <td class="text-center"><%= `${d}-${m}-${y} √† ${hours}:${minutes}` %></td>
                <!-- <td>
                    <form id="deleteForm< h._id %>" action="/histos/< h._id %>" method="POST" style="display: inline;">
                        <input type="hidden" name="_method" value="DELETE">
                        <button title="Supprimer" class="editOnModal btn-delete" type="submit" onclick="return confirm('√ätes-vous s√ªr de vouloir supprimer cette entr√©e de l\'historique ?')">
                            üóëÔ∏è
                        </button>
                    </form>
                </td> -->
                <td>
                    <button title="Consulter" class="editOnModal btn-view" value="<%=h._id%>" type="button" data-toggle="modal" data-target="#exampleModal<%=h._id%>">
                        üëÅÔ∏è‚Äçüó®Ô∏è
                    </button>
                    <div class="modal fade" id="exampleModal<%=h._id%>" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">D√©tails d'historique</h5>
                            </div>
                            <% let trackFileOne = h.track_file_one; %>
                            <% let trackFileTwo = h.track_file_two; %>
                            <div class="modal-body text-center" style="margin-left: 3.8rem;">
                                <div class="row mb-2 text-center">
                                    <div class="col-md-10">
                                        <label for="code" style="color: #1e4960; font-weight: 400;">Identifiant S√©curis√©</label>
                                        <input name="code_postal" type="text" id="code" class="form-control text-center" placeholder="<%=h._id%>" disabled/>
                                    </div>
                                    <div class="col-md-10">
                                      <label for="num_or" style="color: #1e4960; font-weight: 400;">Num√©ro OR</label>
                                      <input name="num_or" type="text" id="num_or" class="form-control text-center" placeholder="<%=h.or_number%>" disabled/>
                                    </div>
                                    <div class="col-md-10">
                                        <label for="email_client" style="color: #1e4960; font-weight: 400;">Email Client</label>
                                        <input name="email_client" type="text" id="email_client" class="form-control text-center" placeholder="<%=h.email_client%>" disabled/>
                                    </div>
                                    <div class="col-md-10">
                                        <label for="emp_charge" style="color: #1e4960; font-weight: 400;">Employ√© en charge</label>
                                        <input name="emp_charge" type="text" id="emp_charge" class="form-control text-center" placeholder="<%=h.employe_in_charge%>" disabled/>
                                    </div>
                                    <div class="col-md-10">
                                        <label for="date_creation" style="color: #1e4960; font-weight: 400;">Date de cr√©ation</label>
                                        <input name="date_creation" type="text" id="date_creation" class="form-control text-center" placeholder="<%= d %>/<%= m %>/<%= y %>" disabled/>
                                    </div>
                                    <div class="col-md-10" style="margin-top: 2rem;">
                                        <h6>OR : <button value="<%=trackFileOne%>" type="button" class="btn btn-outline-secondary accessPdfButton">Acc√©der au fichier d'OR</button></h6> 
                                    </div>
                                    <div class="col-md-10">
                                        <h6>Contrat : <button value="<%=trackFileTwo%>" type="button" class="btn btn-outline-info accessPdfButton2">Acc√©der au contrat</button></h6> 
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                    </div>
                   
                </td>
            </tr>
            <% }); %>
        </tbody>
      </table>
</div>

</body>
<script>

$(".accessPdfButton").click(function() {
    let data = $(this).val();
    console.log("OR ----- ", data);
    window.open(`http://149.56.26.163:5500/pdf/${data}`, '_blank');
});

$(".accessPdfButton2").click(function() {
    let data2 = $(this).val();
    console.log("Contract ----- ", data2);
    window.open(`http://149.56.26.163:5500/pdf_contract/${data2}`, '_blank');
});

$(".accessPdfButton3").click(function() {
    window.location.href = "/";
});
$(".accessPdfButton4").click(function() {
    window.location.href = "/signs";
});

$('#example').DataTable({
        "language": {
        "url": "https://cdn.datatables.net/plug-ins/1.11.3/i18n/fr_fr.json",
        "initComplete": function () {
            // Remove hover effect on pagination
            $('.dataTables_wrapper .dataTables_paginate .paginate_button:hover').css({
                "background-color": "transparent",
                "color": "inherit",
                "border": "none"
            });
        }
}});

</script>
</html>